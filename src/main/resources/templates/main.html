<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>ë©”ì¸ í˜ì´ì§€</title>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/main_style.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css"
		rel="stylesheet">
	
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
	<script>
	    const API_BASE_URL = 'http://localhost:8485/api/music'; // ë°±ì—”ë“œ API ê¸°ë³¸ URL
	    let currentPage = 0; // í˜„ì¬ í˜ì´ì§€ (0ë¶€í„° ì‹œì‘)
	    let totalPages = 0; // ì´ í˜ì´ì§€ ìˆ˜
	    let currentKeyword = ''; // í˜„ì¬ ê²€ìƒ‰ í‚¤ì›Œë“œ
	    let jwtToken = ''; // ì¿ í‚¤ì—ì„œ ê°€ì ¸ì˜¬ JWT í† í°
	    const pageSize = 12; // music_listì— ì‚¬ìš©ë˜ëŠ” í•œ í˜ì´ì§€ ìŒì•… ê°œìˆ˜

	    // JWT í† í°ì„ ì¿ í‚¤ì—ì„œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
	    function getCookie(name) {
	        console.log(`[getCookie] Attempting to get cookie: ${name}`);
	        console.log(`[getCookie] document.cookie current value: '${document.cookie}'`);

	        const nameEQ = name + "=";
	        const ca = document.cookie.split(';');
	        for(let i=0; i < ca.length; i++) {
	            let c = ca[i];
	            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
	            if (c.indexOf(nameEQ) === 0) {
	                const foundValue = c.substring(nameEQ.length, c.length);
	                console.log(`[getCookie] Found cookie '${name}' with value: ${foundValue.substring(0, 30)}...`); // ê°’ì˜ ì¼ë¶€ë§Œ ë¡œê¹…
	                return foundValue;
	            }
	        }
	        console.log(`[getCookie] Cookie '${name}' not found.`);
	        return null;
	    }

	    // duration (ì´ˆ)ë¥¼ "ë¶„:ì´ˆ" í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
	    function formatDuration(seconds) {
	        const minutes = Math.floor(seconds / 60);
	        const remainingSeconds = Math.floor(seconds % 60);
	        return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
	    }

	    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¿ í‚¤ì—ì„œ í† í° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì´ˆê¸° ìŒì•… ëª©ë¡ ë¡œë“œ
	    document.addEventListener('DOMContentLoaded', () => {
	        console.log('[DOMContentLoaded] Page loaded. Attempting to get JWT token.');
	        const storedToken = getCookie('jwt_token');
	        if (storedToken) {
	            jwtToken = storedToken;
	            console.log('JWT í† í°ì„ ì¿ í‚¤ì—ì„œ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. ê°’ì˜ ê¸¸ì´:', jwtToken.length);
	            console.log('JWT í† í° ê°’ (ì²˜ìŒ 30ì):', jwtToken.substring(0, 30) + '...');
	        } else {
	            console.warn('JWT í† í°ì´ ì¿ í‚¤ì— ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ê¸°ëŠ¥ ë° ì¸ì¦ëœ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
	        }
	        
	        fetchPublicMusicList(); 
	        initializePlaylistModal(); 
	    });

	    // ìŒì•… ê²€ìƒ‰ í•¨ìˆ˜ (main.htmlì˜ ê²€ìƒ‰ ë°”ìš©)
	    async function searchMusic(page = 0) {
	        currentKeyword = document.getElementById('keywordInput').value;
	        currentPage = page;

	        if (!currentKeyword) {
	            alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
	            return;
	        }

	        const url = `${API_BASE_URL}/search?keyword=${encodeURIComponent(currentKeyword)}&page=${currentPage}&size=10&sort=uploadDate,desc`;

	        try {
	            const headers = {
	                'Content-Type': 'application/json'
	            };
	            if (jwtToken) {
	                headers['Authorization'] = `Bearer ${jwtToken}`; // â­ Access Tokenì´ HttpOnlyê°€ ì•„ë‹ˆë¯€ë¡œ ìˆ˜ë™ ì¶”ê°€
	                console.log('[searchMusic] Authorization header added with JWT token. Token length:', jwtToken.length);
	            } else {
	                console.warn('[searchMusic] No JWT token available for search request. It might be absent or expired.');
	            }

	            const response = await fetch(url, { headers: headers, credentials: 'include' }); // â­ credentials: 'include' ì¶”ê°€

	            if (!response.ok) {
	                if (response.status === 401 || response.status === 403) {
	                     document.getElementById('resultsContainer').innerHTML = `<p style="color: red;">ê²€ìƒ‰ ê¶Œí•œì´ ì—†ê±°ë‚˜ ë¡œê·¸ì¸ ë§Œë£Œì…ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>`;
	                     console.error('[searchMusic] Search failed: Unauthorized or Forbidden. Status:', response.status);
	                }
	                const errorText = await response.text();
	                throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
	            }

	            const data = await response.json();
	            displayResults(data);
	        } catch (error) {
	            console.error('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
	            document.getElementById('resultsContainer').innerHTML = `<p style="color: red;">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</p>`;
	        }
	    }

	    // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜ (main.htmlì˜ ê²€ìƒ‰ ë°”ìš©)
	    function displayResults(data) {
	        const resultsContainer = document.getElementById('resultsContainer');
	        resultsContainer.innerHTML = ''; // ê¸°ì¡´ ê²°ê³¼ ì§€ìš°ê¸°

	        if (data.content && data.content.length > 0) {
	            data.content.forEach(music => {
	                const musicItem = document.createElement('div');
	                musicItem.classList.add('music-item');
	                musicItem.innerHTML = `
	                    <h3>${music.title}</h3>
	                    <p><strong>ì•„í‹°ìŠ¤íŠ¸:</strong> ${music.artist}</p>
	                    <p><strong>ì•¨ë²”:</strong> ${music.album || 'ì •ë³´ ì—†ìŒ'}</p>
	                    <p><strong>ì—…ë¡œë“œ ë‚ ì§œ:</strong> ${new Date(music.uploadDate).toLocaleString()}</p>
	                    <p><strong>ì¬ìƒ ì‹œê°„:</strong> ${formatDuration(music.duration)}</p>
	                    <button onclick="togglePlayPause(event, '${music.id}', this)">ì¬ìƒ</button> `;
	                resultsContainer.appendChild(musicItem);
	            });
	        } else {
	            resultsContainer.innerHTML = '<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
	        }

	        // í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸
	        currentPage = data.pageable.pageNumber;
	        totalPages = data.totalPages;
	        document.getElementById('currentPageInfo').textContent = `í˜ì´ì§€ ${currentPage + 1} / ${totalPages}`;

	        document.getElementById('prevPageBtn').disabled = data.first;
	        document.getElementById('nextPageBtn').disabled = data.last;
	    }

	    // í˜ì´ì§€ ë³€ê²½ í•¨ìˆ˜ (main.htmlì˜ ê²€ìƒ‰ ë°”ìš©)
	    function changePage(delta) {
	        searchMusic(currentPage + delta);
	    }

	    // music_list.htmlì—ì„œ ê°€ì ¸ì˜¨ ìŒì•… ìŠ¤íŠ¸ë¦¬ë° í•¨ìˆ˜
	    let currentPlayingAudio = null;
	    let currentPlayingButton = null;

	    async function checkLoginStatus() {
	        try {
	            const headers = {};
	            if (jwtToken) { // JWT í† í°ì´ ìˆë‹¤ë©´ ì¶”ê°€
	                headers['Authorization'] = `Bearer ${jwtToken}`; // â­ Access Tokenì´ HttpOnlyê°€ ì•„ë‹ˆë¯€ë¡œ ìˆ˜ë™ ì¶”ê°€
	                console.log('[checkLoginStatus] Authorization header added. Token length:', jwtToken.length);
	            } else {
	                console.warn('[checkLoginStatus] No JWT token available for /api/user/me. Attempting with credentials:include.');
	            }
	            console.log('Headers sent for /api/user/me:', headers);

	            const response = await fetch('/api/user/me', {
	                method: 'GET',
	                headers: headers,
	                credentials: 'include',
	                redirect: 'follow'
	            });

	            console.log('[checkLoginStatus] Response status for /api/user/me:', response.status);

	            if (response.status === 401 || response.status === 403) {
	                console.warn('[checkLoginStatus] User is not logged in or session expired. Status:', response.status);
	                return false;
	            }
	            return response.ok;
	        } catch (err) {
	            console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', err);
	            return false;
	        }
	    }

	    async function togglePlayPause(event, musicId, buttonElement) {
	        event.stopPropagation();
	        console.log('[togglePlayPause] Music ID:', musicId, 'Button element:', buttonElement);
	        const isLoggedIn = await checkLoginStatus();
	        console.log('[togglePlayPause] Is user logged in?', isLoggedIn); // â­ ë””ë²„ê¹… ë¡œê·¸ â­

	        if (!isLoggedIn) {
	            alert('ìŠ¤íŠ¸ë¦¬ë°ì„ ìœ„í•´ì„œëŠ” ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
	            window.location.href = '/custom_login';
	            return;
	        }

	        const audioPlayer = document.getElementById(`audio-${musicId}`);
	        const iconElement = buttonElement.querySelector('i');

	        if (audioPlayer && !audioPlayer.paused) {
	            console.log('[togglePlayPause] Pausing current audio.');
	            audioPlayer.pause();
	            iconElement.className = 'bi bi-play-fill';
	            buttonElement.textContent = ' ì¬ìƒ';
	            buttonElement.prepend(iconElement);
	            currentPlayingAudio = null;
	            currentPlayingButton = null;
	            return;
	        }

	        if (currentPlayingAudio && currentPlayingAudio !== audioPlayer) {
	            console.log('[togglePlayPause] Pausing previously playing audio.');
	            currentPlayingAudio.pause();
	            if (currentPlayingButton) {
	                currentPlayingButton.innerHTML = '<i class="bi bi-play-fill"></i> ì¬ìƒ';
	            }
	        }

	        if (audioPlayer) {
	            try {
	                console.log(`[togglePlayPause] Attempting to play audio from: ${audioPlayer.src}`); // â­ ë””ë²„ê¹… ë¡œê·¸ â­
	                await audioPlayer.play();
	                console.log('[togglePlayPause] Audio playback initiated successfully.');
	                iconElement.className = 'bi bi-pause-fill';
	                buttonElement.textContent = ' ì¼ì‹œì •ì§€';
	                buttonElement.prepend(iconElement);
	                currentPlayingAudio = audioPlayer;
	                currentPlayingButton = buttonElement;
	            } catch (error) {
	                console.error('ìŒì•… ì¬ìƒ ì‹¤íŒ¨:', error);
	                if (error.name === 'NotAllowedError') {
	                    alert('ìŒì•… ìë™ ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
	                } else if (error.name === 'NotSupportedError') {
	                    alert('ì§€ì›ë˜ì§€ ì•ŠëŠ” ì˜¤ë””ì˜¤ í˜•ì‹ì…ë‹ˆë‹¤.');
	                } else {
	                    alert('ìŒì•… ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
	                }
	            }
	        } else {
	            console.error('[togglePlayPause] Audio player element not found for music ID:', musicId);
	        }
	    }
	    
	    // music_list.htmlì—ì„œ ê°€ì ¸ì˜¨ ê³µê°œìš© ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
	    async function fetchPublicMusicList() {
	        const listContainer = document.getElementById('public-music-list-container');
	        let loadingMessage = document.getElementById('loading-message');

	        if (loadingMessage) {
	            loadingMessage.style.display = 'block';
	        } else {
	            loadingMessage = document.createElement('p');
	            loadingMessage.id = 'loading-message';
	            loadingMessage.className = 'text-center text-muted';
	            loadingMessage.textContent = 'ìŒì•…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
	            document.querySelector('.card-body')?.prepend(loadingMessage); 
	        }

	        listContainer.innerHTML = '';

	        try {
	            const headers = {};
	            if (jwtToken) { // JWT í† í°ì´ ìˆë‹¤ë©´ ì¶”ê°€
	                headers['Authorization'] = `Bearer ${jwtToken}`; // â­ Access Tokenì´ HttpOnlyê°€ ì•„ë‹ˆë¯€ë¡œ ìˆ˜ë™ ì¶”ê°€
	                console.log('[fetchPublicMusicList] Authorization header added with JWT token. Token length:', jwtToken.length);
	            } else {
	                console.warn('[fetchPublicMusicList] No JWT token available for public music list request. It might be absent or expired.');
	            }

	            const response = await fetch(`${API_BASE_URL}?page=${currentPage}&size=${pageSize}&sort=uploadDate,desc`, { headers: headers, credentials: 'include' }); // â­ credentials: 'include' ì¶”ê°€

	            if (response.status === 401 || response.status === 403) {
	                console.warn('ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ì¸ì¦ ë˜ëŠ” ê¶Œí•œ ë¶€ì¡±. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
	                if (loadingMessage) loadingMessage.style.display = 'none';
	                listContainer.innerHTML = '<p class="text-danger text-center">ìŒì•… ëª©ë¡ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';
	                alert('ìŒì•… ëª©ë¡ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
	                window.location.href = '/custom_login';
	                return;
	            }

	            if (!response.ok) {
	                throw new Error(`HTTP error! status: ${response.status}`);
	            }
	            const pageData = await response.json();
	            const musicList = pageData.content;

	            if (musicList && musicList.length > 0) {
	                loadingMessage.style.display = 'none';
	                musicList.forEach(music => {
	                    const coverFileName = music.coverImagePath
	                                       ? music.coverImagePath.split('/').pop().split('\\').pop()
	                                       : null;

	                    const coverImageUrl = coverFileName
	                                       ? `http://localhost:8485/api/files/cover-image/${coverFileName}`
	                                       : '/images/default_album_cover.png';

	                    const colDiv = document.createElement('div');
	                    colDiv.className = 'col-md-3 col-sm-6';
	                    colDiv.innerHTML = `
	                        <div class="card music-card">
	                            <a href="/music_detail?id=${music.id}" class="music-info-link">
	                                <img 
	                                    src="${coverImageUrl}" 
	                                    class="card-img-top" 
	                                    alt="ì•¨ë²” ì»¤ë²„"
	                                    onerror="this.onerror=null;this.src='/images/default_album_cover.png';"> </a>

	                            <div class="card-body music-card-body">
	                                <a href="/music_detail?id=${music.id}" class="music-info-link">
	                                    <h5 class="music-title">${music.title}</h5>
	                                    <p class="music-artist">${Array.isArray(music.artist) ? music.artist.join(', ') : music.artist}</p>
	                                    <p class="music-album">${music.album ? music.album : 'N/A'}</p>
	                                    <small class="text-muted">
	                                        ${music.duration ? 'ì¬ìƒ ì‹œê°„: ' + formatDuration(music.duration) : ''}
	                                    </small>
	                                </a>

	                                <div class="play-button-container">
	                                    <audio id="audio-${music.id}" preload="none" style="display: none;">
	                                        <source src="${API_BASE_URL}/stream/${music.id}" type="audio/mpeg">
	                                        Your browser does not support the audio element.
	                                    </audio>

	                                    <button class="btn btn-dark" onclick="togglePlayPause(event, ${music.id}, this)">
	                                        <i class="bi bi-play-fill"></i> ì¬ìƒ
	                                    </button>
	                                </div>
	                            </div>
	                        </div>
	                    `;
	                    listContainer.appendChild(colDiv);
	                });
	            } else {
	                listContainer.innerHTML = '<p class="text-center text-muted">ë“±ë¡ëœ ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
	                loadingMessage.style.display = 'none';
	            }
	        } catch (error) {
	            console.error('ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
	            if (loadingMessage) loadingMessage.style.display = 'none';
	            listContainer.innerHTML = '<p class="text-danger text-center">ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
	        }
	    }

	    // music_list.htmlì—ì„œ ê°€ì ¸ì˜¨ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ì´ˆê¸°í™” ë¡œì§
	    function initializePlaylistModal() {
	        const createPlaylistForm = document.getElementById('createPlaylistForm');
	        const createPlaylistModalElement = document.getElementById('createPlaylistModal');
	        let createPlaylistModal = null;

	        if (createPlaylistModalElement) {
	            createPlaylistModal = new bootstrap.Modal(createPlaylistModalElement);
	        } else {
	            console.warn("ê²½ê³ : ID 'createPlaylistModal'ì„ ê°€ì§„ HTML ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ì´ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
	        }

	        if (createPlaylistForm && createPlaylistModal) {
	            createPlaylistForm.addEventListener('submit', async function(event) {
	                event.preventDefault();

	                const title = document.getElementById('playlistTitle').value;
	                const description = document.getElementById('playlistDescription').value;

	                if (!title.trim()) {
	                    alert('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
	                    return;
	                }

	                try {
	                    const response = await fetch('/api/playlists', {
	                        method: 'POST',
	                        headers: {
	                            'Content-Type': 'application/json',
	                            'Authorization': `Bearer ${jwtToken}` // â­ Access Tokenì´ HttpOnlyê°€ ì•„ë‹ˆë¯€ë¡œ ìˆ˜ë™ ì¶”ê°€
	                        },
	                        credentials: 'include', // â­ credentials: 'include' ì¶”ê°€
	                        body: JSON.stringify({ title, description })
	                    });

	                    if (response.ok) {
	                        const newPlaylist = await response.json();
	                        alert(`í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ '${newPlaylist.title}'ì´(ê°€) ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
	                        createPlaylistModal.hide();
	                        createPlaylistForm.reset();
	                        window.location.reload();
	                    } else if (response.status === 401) {
	                        alert('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±ì€ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
	                        window.location.href = '/custom_login';
	                    } else if (response.status === 400) {
	                        const errorData = await response.json();
	                        alert('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹¤íŒ¨: ' + (errorData.message || 'ì œëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'));
	                    } else {
	                        alert('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
	                        console.error('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹¤íŒ¨:', response.status, await response.text());
	                    }
	                } catch (error) {
	                    console.error('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ìš”ì²­ ì¤‘ ì—ëŸ¬:', error);
	                    alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ë¬¸ì œ ë°œìƒ.');
	                }
	            });
	        } else {
	            console.warn("ê²½ê³ : í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± í¼ ë˜ëŠ” ëª¨ë‹¬ ìš”ì†Œê°€ ì—†ê±°ë‚˜, Bootstrap ëª¨ë‹¬ ê°ì²´ë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë ¨ ê¸°ëŠ¥ì´ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
	        }
	    }
	</script>
	<!--<script>
	    const API_BASE_URL = 'http://localhost:8485/api/music'; // ë°±ì—”ë“œ API ê¸°ë³¸ URL
	    let currentPage = 0; // í˜„ì¬ í˜ì´ì§€ (0ë¶€í„° ì‹œì‘)
	    let totalPages = 0; // ì´ í˜ì´ì§€ ìˆ˜
	    let currentKeyword = ''; // í˜„ì¬ ê²€ìƒ‰ í‚¤ì›Œë“œ
	    let jwtToken = ''; // ì¿ í‚¤ì—ì„œ ê°€ì ¸ì˜¬ JWT í† í°
	    const pageSize = 12; // music_listì— ì‚¬ìš©ë˜ëŠ” í•œ í˜ì´ì§€ ìŒì•… ê°œìˆ˜

	    // JWT í† í°ì„ ì¿ í‚¤ì—ì„œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
	    function getCookie(name) {
	        // â­ ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€ ì‹œì‘ â­
	        console.log(`[getCookie] Attempting to get cookie: ${name}`);
	        console.log(`[getCookie] document.cookie current value: '${document.cookie}'`);
	        // â­ ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€ ë â­

	        const nameEQ = name + "=";
	        const ca = document.cookie.split(';');
	        for(let i=0; i < ca.length; i++) {
	            let c = ca[i];
	            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
	            if (c.indexOf(nameEQ) === 0) {
	                const foundValue = c.substring(nameEQ.length, c.length);
	                console.log(`[getCookie] Found cookie '${name}' with value: ${foundValue.substring(0, 30)}...`); // ê°’ì˜ ì¼ë¶€ë§Œ ë¡œê¹…
	                return foundValue;
	            }
	        }
	        console.log(`[getCookie] Cookie '${name}' not found.`);
	        return null;
	    }

	    // duration (ì´ˆ)ë¥¼ "ë¶„:ì´ˆ" í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
	    function formatDuration(seconds) {
	        const minutes = Math.floor(seconds / 60);
	        const remainingSeconds = Math.floor(seconds % 60);
	        return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
	    }

	    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¿ í‚¤ì—ì„œ í† í° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì´ˆê¸° ìŒì•… ëª©ë¡ ë¡œë“œ
	    document.addEventListener('DOMContentLoaded', () => {
	        console.log('[DOMContentLoaded] Page loaded. Attempting to get JWT token.');
	        const storedToken = getCookie('jwt_token');
	        if (storedToken) {
	            jwtToken = storedToken;
	            console.log('JWT í† í°ì„ ì¿ í‚¤ì—ì„œ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
	        } else {
	            console.warn('JWT í† í°ì´ ì¿ í‚¤ì— ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ê¸°ëŠ¥ì— ì¸ì¦ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
	        }
	        
	        // music_list.htmlì—ì„œ ê°€ì ¸ì˜¨ ì´ˆê¸° ìŒì•… ëª©ë¡ ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ
	        fetchPublicMusicList(); 
	        // music_list.htmlì—ì„œ ê°€ì ¸ì˜¨ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
	        initializePlaylistModal(); 
	    });

	    // ìŒì•… ê²€ìƒ‰ í•¨ìˆ˜ (main.htmlì˜ ê²€ìƒ‰ ë°”ìš©)
	    async function searchMusic(page = 0) {
	        currentKeyword = document.getElementById('keywordInput').value;
	        currentPage = page;

	        if (!currentKeyword) {
	            alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
	            return;
	        }

	        const url = `${API_BASE_URL}/search?keyword=${encodeURIComponent(currentKeyword)}&page=${currentPage}&size=10&sort=uploadDate,desc`;

	        try {
	            const headers = {
	                'Content-Type': 'application/json'
	            };
	            if (jwtToken) {
	                headers['Authorization'] = `Bearer ${jwtToken}`;
	                console.log('[searchMusic] Authorization header added with JWT token.');
	            } else {
	                console.warn('[searchMusic] No JWT token available for search request.');
	            }

	            const response = await fetch(url, { headers: headers });

	            if (!response.ok) {
	                if (response.status === 401 || response.status === 403) {
	                     document.getElementById('resultsContainer').innerHTML = `<p style="color: red;">ê²€ìƒ‰ ê¶Œí•œì´ ì—†ê±°ë‚˜ ë¡œê·¸ì¸ ë§Œë£Œì…ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>`;
	                     console.error('[searchMusic] Search failed: Unauthorized or Forbidden. Status:', response.status);
	                }
	                const errorText = await response.text();
	                throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
	            }

	            const data = await response.json();
	            displayResults(data);
	        } catch (error) {
	            console.error('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
	            document.getElementById('resultsContainer').innerHTML = `<p style="color: red;">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</p>`;
	        }
	    }

	    // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜ (main.htmlì˜ ê²€ìƒ‰ ë°”ìš©)
	    function displayResults(data) {
	        const resultsContainer = document.getElementById('resultsContainer');
	        resultsContainer.innerHTML = ''; // ê¸°ì¡´ ê²°ê³¼ ì§€ìš°ê¸°

	        if (data.content && data.content.length > 0) {
	            data.content.forEach(music => {
	                const musicItem = document.createElement('div');
	                musicItem.classList.add('music-item');
	                musicItem.innerHTML = `
	                    <h3>${music.title}</h3>
	                    <p><strong>ì•„í‹°ìŠ¤íŠ¸:</strong> ${music.artist}</p>
	                    <p><strong>ì•¨ë²”:</strong> ${music.album || 'ì •ë³´ ì—†ìŒ'}</p>
	                    <p><strong>ì—…ë¡œë“œ ë‚ ì§œ:</strong> ${new Date(music.uploadDate).toLocaleString()}</p>
	                    <p><strong>ì¬ìƒ ì‹œê°„:</strong> ${formatDuration(music.duration)}</p>
	                    <button onclick="streamMusic(this, '${music.id}')">ì¬ìƒ</button> `;
	                resultsContainer.appendChild(musicItem);
	            });
	        } else {
	            resultsContainer.innerHTML = '<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
	        }

	        // í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸
	        currentPage = data.pageable.pageNumber;
	        totalPages = data.totalPages;
	        document.getElementById('currentPageInfo').textContent = `í˜ì´ì§€ ${currentPage + 1} / ${totalPages}`;

	        document.getElementById('prevPageBtn').disabled = data.first;
	        document.getElementById('nextPageBtn').disabled = data.last;
	    }

	    // í˜ì´ì§€ ë³€ê²½ í•¨ìˆ˜ (main.htmlì˜ ê²€ìƒ‰ ë°”ìš©)
	    function changePage(delta) {
	        searchMusic(currentPage + delta);
	    }

	    // music_list.htmlì—ì„œ ê°€ì ¸ì˜¨ ìŒì•… ìŠ¤íŠ¸ë¦¬ë° í•¨ìˆ˜
	    let currentPlayingAudio = null;
	    let currentPlayingButton = null;
	    async function checkLoginStatus() {
	        try {
	            // credentials: 'include'ëŠ” ì„¸ì…˜ ì¿ í‚¤ë¥¼ ìë™ìœ¼ë¡œ í¬í•¨í•©ë‹ˆë‹¤.
	            // HttpOnly JWT í† í°ì´ ì•„ë‹Œ ê²½ìš°, ì—¬ê¸°ì„œ ì§ì ‘ Authorization í—¤ë”ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
	            const headers = {};
	            if (jwtToken) { // JWT í† í°ì´ ìˆë‹¤ë©´ ì¶”ê°€
	                headers['Authorization'] = `Bearer ${jwtToken}`;
	            }

	            const response = await fetch('/api/user/me', {
	                method: 'GET',
	                headers: headers, // í—¤ë” ì ìš©
	                credentials: 'include', // ì„¸ì…˜ ì¸ì¦ ìœ ì§€ (JSESSIONID ë“±)
	                redirect: 'manual'
	            });

	            if (response.status === 401 || response.status === 403) return false;
	            return response.ok;
	        } catch (err) {
	            console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', err);
	            return false;
	        }
	    }

	    async function togglePlayPause(event, musicId, buttonElement) {
	        event.stopPropagation();
	        const isLoggedIn = await checkLoginStatus();
	        if (!isLoggedIn) {
	            alert('ìŠ¤íŠ¸ë¦¬ë°ì„ ìœ„í•´ì„œëŠ” ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
	            window.location.href = '/custom_login';
	            return;
	        }

	        const audioPlayer = document.getElementById(`audio-${musicId}`);
	        const iconElement = buttonElement.querySelector('i');

	        if (audioPlayer && !audioPlayer.paused) {
	            audioPlayer.pause();
	            iconElement.className = 'bi bi-play-fill';
	            buttonElement.textContent = ' ì¬ìƒ';
	            buttonElement.prepend(iconElement);
	            currentPlayingAudio = null;
	            currentPlayingButton = null;
	            return;
	        }

	        if (currentPlayingAudio && currentPlayingAudio !== audioPlayer) {
	            currentPlayingAudio.pause();
	            if (currentPlayingButton) {
	                currentPlayingButton.innerHTML = '<i class="bi bi-play-fill"></i> ì¬ìƒ';
	            }
	        }

	        if (audioPlayer) {
	            try {
	                await audioPlayer.play();
	                iconElement.className = 'bi bi-pause-fill';
	                buttonElement.textContent = ' ì¼ì‹œì •ì§€';
	                buttonElement.prepend(iconElement);
	                currentPlayingAudio = audioPlayer;
	                currentPlayingButton = buttonElement;
	            } catch (error) {
	                console.error('ìŒì•… ì¬ìƒ ì‹¤íŒ¨:', error);
	                if (error.name === 'NotAllowedError') {
	                    alert('ìŒì•… ìë™ ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
	                } else {
	                    alert('ìŒì•… ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
	                }
	            }
	        }
	    }
	    
	    // music_list.htmlì—ì„œ ê°€ì ¸ì˜¨ ê³µê°œìš© ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
	    async function fetchPublicMusicList() {
	        const listContainer = document.getElementById('public-music-list-container');
	        let loadingMessage = document.getElementById('loading-message');

	        if (loadingMessage) {
	            loadingMessage.style.display = 'block';
	        } else {
	            loadingMessage = document.createElement('p');
	            loadingMessage.id = 'loading-message';
	            loadingMessage.className = 'text-center text-muted';
	            loadingMessage.textContent = 'ìŒì•…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
	            // music_listì˜ card-bodyê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ DOMContentLoaded ì´í›„ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
	            document.querySelector('.card-body')?.prepend(loadingMessage); 
	        }

	        listContainer.innerHTML = ''; // ê¸°ì¡´ ìŒì•… ì¹´ë“œë“¤ì„ ëª¨ë‘ ì œê±°

	        try {
	            const headers = {};
	            if (jwtToken) { // JWT í† í°ì´ ìˆë‹¤ë©´ ì¶”ê°€
	                headers['Authorization'] = `Bearer ${jwtToken}`;
	                console.log('[fetchPublicMusicList] Authorization header added with JWT token.');
	            } else {
	                console.warn('[fetchPublicMusicList] No JWT token available for public music list request. This might be public.');
	            }

	            const response = await fetch(`${API_BASE_URL}?page=${currentPage}&size=${pageSize}&sort=uploadDate,desc`, { headers: headers });

	            if (response.status === 401 || response.status === 403) {
	                console.warn('ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ì¸ì¦ ë˜ëŠ” ê¶Œí•œ ë¶€ì¡±. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
	                if (loadingMessage) loadingMessage.style.display = 'none';
	                listContainer.innerHTML = '<p class="text-danger text-center">ìŒì•… ëª©ë¡ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';
	                alert('ìŒì•… ëª©ë¡ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
	                window.location.href = '/custom_login';
	                return;
	            }

	            if (!response.ok) {
	                throw new Error(`HTTP error! status: ${response.status}`);
	            }
	            const pageData = await response.json();
	            const musicList = pageData.content;

	            if (musicList && musicList.length > 0) {
	                loadingMessage.style.display = 'none'; // ë¡œë”© ë©”ì‹œì§€ ìˆ¨ê¹€
	                musicList.forEach(music => {
	                    const coverFileName = music.coverImagePath
	                                       ? music.coverImagePath.split('/').pop().split('\\').pop() // ìŠ¬ë˜ì‹œì™€ ì—­ìŠ¬ë˜ì‹œ ëª¨ë‘ ì²˜ë¦¬
	                                       : null;

	                                   const coverImageUrl = coverFileName
	                                       ? `http://localhost:8485/api/files/cover-image/${coverFileName}`
	                                       : '/images/default_album_cover.png'; // ê¸°ë³¸ ì´ë¯¸ì§€ ê²½ë¡œ

	                    const colDiv = document.createElement('div');
	                    colDiv.className = 'col-md-3 col-sm-6';
	                    colDiv.innerHTML = `
	                        <div class="card music-card">
	                            <a href="/music_detail?id=${music.id}" class="music-info-link">
	                                <img 
	                                    src="${coverImageUrl}" 
	                                    class="card-img-top" 
	                                    alt="ì•¨ë²” ì»¤ë²„"
	                                    onerror="this.onerror=null;this.src='/images/default_album_cover.png';"> </a>

	                            <div class="card-body music-card-body">
	                                <a href="/music_detail?id=${music.id}" class="music-info-link">
	                                    <h5 class="music-title">${music.title}</h5>
	                                    <p class="music-artist">${Array.isArray(music.artist) ? music.artist.join(', ') : music.artist}</p>
	                                    <p class="music-album">${music.album ? music.album : 'N/A'}</p>
	                                    <small class="text-muted">
	                                        ${music.duration ? 'ì¬ìƒ ì‹œê°„: ' + formatDuration(music.duration) : ''}
	                                    </small>
	                                </a>

	                                <div class="play-button-container">
	                                    <audio id="audio-${music.id}" preload="none" style="display: none;">
	                                        <source src="${API_BASE_URL}/stream/${music.id}" type="audio/mpeg">
	                                        Your browser does not support the audio element.
	                                    </audio>

	                                    <button class="btn btn-dark" onclick="togglePlayPause(event, ${music.id}, this)">
	                                        <i class="bi bi-play-fill"></i> ì¬ìƒ
	                                    </button>
	                                </div>
	                            </div>
	                        </div>
	                    `;
	                    listContainer.appendChild(colDiv);
	                });
	            } else {
	                listContainer.innerHTML = '<p class="text-center text-muted">ë“±ë¡ëœ ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
	                loadingMessage.style.display = 'none';
	            }
	        } catch (error) {
	            console.error('ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
	            if (loadingMessage) loadingMessage.style.display = 'none';
	            listContainer.innerHTML = '<p class="text-danger text-center">ìŒì•… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
	        }
	    }

	    // music_list.htmlì—ì„œ ê°€ì ¸ì˜¨ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ì´ˆê¸°í™” ë¡œì§
	    function initializePlaylistModal() {
	        const createPlaylistForm = document.getElementById('createPlaylistForm');
	        const createPlaylistModalElement = document.getElementById('createPlaylistModal');
	        let createPlaylistModal = null;

	        if (createPlaylistModalElement) {
	            createPlaylistModal = new bootstrap.Modal(createPlaylistModalElement);
	        } else {
	            console.warn("ê²½ê³ : ID 'createPlaylistModal'ì„ ê°€ì§„ HTML ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ì´ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
	        }

	        if (createPlaylistForm && createPlaylistModal) {
	            createPlaylistForm.addEventListener('submit', async function(event) {
	                event.preventDefault();

	                const title = document.getElementById('playlistTitle').value;
	                const description = document.getElementById('playlistDescription').value;

	                if (!title.trim()) {
	                    alert('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
	                    return;
	                }

	                try {
	                    const response = await fetch('/api/playlists', {
	                        method: 'POST',
	                        headers: {
	                            'Content-Type': 'application/json',
	                            'Authorization': `Bearer ${jwtToken}` // JWT í† í°ì„ í—¤ë”ì— ì¶”ê°€
	                        },
	                        body: JSON.stringify({ title, description })
	                    });

	                    if (response.ok) {
	                        const newPlaylist = await response.json();
	                        alert(`í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ '${newPlaylist.title}'ì´(ê°€) ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
	                        createPlaylistModal.hide();
	                        createPlaylistForm.reset();
	                        window.location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ëª©ë¡ ì—…ë°ì´íŠ¸ (ê°„ë‹¨í•œ ë°©ë²•)
	                    } else if (response.status === 401) {
	                        alert('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±ì€ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
	                        window.location.href = '/custom_login';
	                    } else if (response.status === 400) {
	                        const errorData = await response.json();
	                        alert('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹¤íŒ¨: ' + (errorData.message || 'ì œëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'));
	                    } else {
	                        alert('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
	                        console.error('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹¤íŒ¨:', response.status, await response.text());
	                    }
	                } catch (error) {
	                    console.error('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ìš”ì²­ ì¤‘ ì—ëŸ¬:', error);
	                    alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ë¬¸ì œ ë°œìƒ.');
	                }
	            });
	        } else {
	            console.warn("ê²½ê³ : í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± í¼ ë˜ëŠ” ëª¨ë‹¬ ìš”ì†Œê°€ ì—†ê±°ë‚˜, Bootstrap ëª¨ë‹¬ ê°ì²´ë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë ¨ ê¸°ëŠ¥ì´ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
	        }
	    }
	</script> -->

    <style>
		body {
			font-family: Arial, sans-serif;
			text-align: center;
			background-color: #f8f9fa;
		}

		.container {
			padding: 30px;
			border-radius: 8px;
			max-width: 960px;
			margin: 50px auto;
			background-color: #ffffff;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
		}

		h1 {
			color: #333;
		}

		p {
			color: #666;
		}

		a {
			text-decoration: none;
			color: #007bff;
		}

		a:hover {
			text-decoration: underline;
		}

		.user-info {
			margin-top: 20px;
			padding: 15px;
			background-color: #f0f8ff;
			border-radius: 5px;
			text-align: left;
		}

		#resultsContainer { 
			border: 1px solid #ccc; 
			padding: 10px; 
			min-height: 100px; 
			text-align: left;
			margin-top: 20px;
		}
		.music-item { 
			border-bottom: 1px dashed #eee; 
			padding: 10px 0; 
		}
		.music-item:last-child { 
			border-bottom: none; 
		}
		.music-item h3 { 
			margin: 0 0 5px 0; 
			color: #333; 
		}
		.music-item p { 
			margin: 0; 
			color: #666; 
			font-size: 0.9em; 
		}
		.music-item button { 
			margin-top: 5px; 
			padding: 5px 10px; 
			background-color: #007bff; 
			color: white; 
			border: none; 
			border-radius: 4px; 
			cursor: pointer; 
		}
		.music-item button:hover { 
			background-color: #0056b3; 
		}
		.pagination {
			text-align: center;
			margin-top: 20px;
		}
		.pagination button { 
			margin: 0 5px; 
			padding: 8px 15px; 
			background-color: #28a745; 
			color: white; 
			border: none; 
			border-radius: 4px; 
			cursor: pointer; 
		}
		.pagination button:disabled { 
			background-color: #cccccc; 
			cursor: not-allowed; 
		}
		.search-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .search-bar input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 20px;
            width: 300px;
        }
        .search-bar .search-button {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        .search-bar .search-button:hover {
            background-color: #0056b3;
        }
	</style>
</head>

<body>
	<header class="main-header">
		<div class="header-content">
			<div class="logo">
				</div>
			<div class="search-bar">
				<input type="text" id="keywordInput" placeholder="ì—¬ë¦„ ë°¤ì„ ë‹´ì€ ê°ì„± ì‹œí‹°íŒ ğŸ¶ï½¥*:.ï½¡.â˜†å½¡"> 
				<button type="button" class="search-button" onclick="searchMusic()">ê²€ìƒ‰</button>
			</div>
		</div>
		<nav class="main-nav">
			<ul>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownChart" role="button"
						data-bs-toggle="dropdown" aria-expanded="false">
						ì°¨íŠ¸100
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdownChart">
						<li><a class="dropdown-item" href="#">ì¼ê°„ ì°¨íŠ¸</a></li>
						<li><a class="dropdown-item" href="#">ì£¼ê°„ ì°¨íŠ¸</a></li>
						<li><a class="dropdown-item" href="#">ì›”ê°„ ì°¨íŠ¸</a></li>
					</ul>
				</li>

				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownNewMusic" role="button"
						data-bs-toggle="dropdown" aria-expanded="false">
						ìµœì‹ ìŒì•…
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdownNewMusic">
						<li><a class="dropdown-item" href="#">ìµœì‹  ê³¡</a></li>
						<li><a class="dropdown-item" href="#">ìµœì‹  ì•¨ë²”</a></li>
					</ul>
				</li>

				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownGenre" role="button"
						data-bs-toggle="dropdown" aria-expanded="false">
						ì¥ë¥´ìŒì•…
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdownGenre">
						<li><a class="dropdown-item" href="#">ë°œë¼ë“œ</a></li>
						<li><a class="dropdown-item" href="#">ëŒ„ìŠ¤</a></li>
						<li><a class="dropdown-item" href="#">í™í•©</a></li>
						<li><a class="dropdown-item" href="#">ë¡</a></li>
						<li><a class="dropdown-item" href="#">ì¬ì¦ˆ</a></li>
						<li><a class="dropdown-item" href="#">POP</a></li>
						<li><a class="dropdown-item" href="#">R&B</a></li>
					</ul>
				</li>

				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownNotice" role="button"
						data-bs-toggle="dropdown" aria-expanded="false">
						ê³µì§€ì‚¬í•­
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdownNotice">
						<li><a class="dropdown-item" href="/notice_list">ì¼ë°˜ ê³µì§€</a></li>
						<li><a class="dropdown-item" href="#">ì—…ë°ì´íŠ¸ ì†Œì‹</a></li>
						<li><a class="dropdown-item" href="#">ì´ë²¤íŠ¸</a></li>
					</ul>
				</li>

				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownRecommend" role="button"
						data-bs-toggle="dropdown" aria-expanded="false">
						ì¶”ì²œ
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdownRecommend">
						<li><a class="dropdown-item" href="#">ë§ì¶¤ ì¶”ì²œ</a></li>
						<li><a class="dropdown-item" href="#">ì—ë””í„° ì¶”ì²œ</a></li>
						<li><a class="dropdown-item" href="#">ì¸ê¸° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</a></li>
					</ul>
				</li>

				<li class="nav-item dropdown">
				    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownFreeboard" role="button"
				        data-bs-toggle="dropdown" aria-expanded="false">
				        ììœ ê²Œì‹œíŒ
				    </a>
				    <ul class="dropdown-menu" aria-labelledby="navbarDropdownFreeboard">
				        <li><a class="dropdown-item" href="/board">ì¸ê¸° ê¸€</a></li> <!-- React ì•±ì˜ ê¸°ë³¸ ê²½ë¡œë¡œ ì´ë™ -->
				        <li><a class="dropdown-item" href="/board/posts/new">ìƒˆ ê¸€ ì‘ì„±</a></li> <!-- React ì•± ë‚´ë¶€ ê²½ë¡œë¡œ ì´ë™ -->
				        <li><a class="dropdown-item" href="/board">ë‚´ ê¸€ ë³´ê¸°</a></li> <!-- React ì•±ì˜ ê¸°ë³¸ ê²½ë¡œë¡œ ì´ë™ -->
				    </ul>
				</li>

				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMusicHug" role="button"
						data-bs-toggle="dropdown" aria-expanded="false">
						ë®¤ì§í—ˆê·¸
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdownMusicHug">
						<li><a class="dropdown-item" href="#">ì‹¤ì‹œê°„ ë“£ê¸°</a></li>
						<li><a class="dropdown-item" href="#">ì¹œêµ¬ ì´ˆëŒ€</a></li>
						<li><a class="dropdown-item" href="#">ë‚´ í—ˆê·¸ë£¸</a></li>
					</ul>
				</li>
			</ul>
		</nav>
	</header>
	<div class="container">
		<h1>í™˜ì˜í•©ë‹ˆë‹¤!</h1>

		<p>ì´ê³³ì€ ë©”ì¸ í˜ì´ì§€ì…ë‹ˆë‹¤. ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

		<div th:if="${session.user != null}" class="user-info">
			<h3>ì‚¬ìš©ì ì •ë³´:</h3>
			<p><strong>ì´ë¦„:</strong> <span th:text="${session.user.username}"></span></p>
			<p><strong>ì´ë©”ì¼:</strong> <span th:text="${session.user.email}"></span></p>
			<p><strong>ë‹‰ë„¤ì„:</strong> <span th:text="${session.user.nickname}"></span></p>
		</div>
		<div th:unless="${session.user != null}" class="user-info">
			<p>ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
		</div>

		<p><a th:href="@{/log_out}">ë¡œê·¸ì•„ì›ƒ</a></p>
		<div class="mt-4">
		          <div th:replace="~{music_list :: musicListContent}"></div>
		      </div>
		
		<h2>ìŒì•… ê²€ìƒ‰ ê²°ê³¼</h2>
		<div id="resultsContainer">
		    <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
		</div>
		
		<div id="paginationContainer" class="pagination">
		    <button onclick="changePage(-1)" id="prevPageBtn" disabled>ì´ì „ í˜ì´ì§€</button>
		    <span id="currentPageInfo">í˜ì´ì§€ 1 / 1</span>
		    <button onclick="changePage(1)" id="nextPageBtn" disabled>ë‹¤ìŒ í˜ì´ì§€</button>
		</div>

	</div>
	<div class="signup-link">
		<p>ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="/custom_login">ë¡œê·¸ì¸</a></p>
		<p>ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="/signup">íšŒì›ê°€ì…</a></p>
	</div>
	<div>
		<p><a href="/mypage">ë§ˆì´í˜ì´ì§€</a></p>
	</div>
	
	<div th:if="${session.user != null and session.user.roles.contains('ROLE_ADMIN')}">
		<a href="/music_upload">ì—…ë¡œë“œ í˜ì´ì§€</a>
	</div>

</body>

</html>